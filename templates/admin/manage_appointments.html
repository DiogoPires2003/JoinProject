<!DOCTYPE html>
<html lang="es">
{% load static %}
{% load bootstrap5 %} {# Load Bootstrap 5 tags #}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionar Citas | Admin | Better Health</title>
    {% bootstrap_css %} {# Include Bootstrap CSS #}
    <link rel="icon" href="{% static 'images/favicon.webp' %}" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    {# Link to your custom admin CSS if you have one #}
    <link rel="stylesheet" href="{% static 'css/admin_styles.css' %}">
    <style>
        /* Optional: Add some specific styles here or in admin_styles.css */
        .table th, .table td {
            vertical-align: middle; /* Align content vertically centered */
        }
        .action-buttons .btn {
            margin-right: 5px; /* Spacing between action buttons */
        }
        .action-buttons .btn:last-child {
            margin-right: 0;
        }
    </style>
</head>

<body>
<div class="navbar-wrapper">
    {% include 'base/navbar.html' %}
</div>

<div class="page-wrapper d-flex flex-column min-vh-100">
    <main class="flex-grow-1 py-5">
        <div class="container">
            <h1 class="mb-4 text-center">Gestionar Citas Médicas</h1>

            {# Optional: Add filters or search functionality here later #}
            {# <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">Filtrar Citas</h5>
                    <form method="get">
                        <!-- Filter fields (e.g., date range, patient search) -->
                    </form>
                </div>
            </div> #}

            {# Button to trigger creation - links to a new URL/view #}
            <div class="text-end mb-3">
                <a href="#" class="btn btn-primary">
                    <i class="fas fa-plus me-1"></i> Crear Nueva Cita
                </a>
            </div>

            {# Display Messages (e.g., success/error after actions) #}
            {% bootstrap_messages %}

            <div class="card shadow-sm">
                <div class="card-header">
                    Listado de Citas Programadas
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th scope="col">Paciente</th>
                                    <th scope="col">Servicio</th>
                                    <th scope="col">Fecha</th>
                                    <th scope="col">Hora Inicio</th>
                                    <th scope="col">Hora Fin</th>
                                    <th scope="col" class="text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {# Loop through appointments passed from the view context #}
                                {% for appointment in appointments %}
                                <tr>
                                    <td>
                                        {# Link to patient detail or just display name #}
                                        {{ appointment.patient.first_name }} {{ appointment.patient.last_name }}
                                        <small class="d-block text-muted">{{ appointment.patient.dni }}</small>
                                    </td>
                                    <td>{{ appointment.service.name|default:"N/A" }}</td>
                                    <td>{{ appointment.date|date:"d/m/Y" }}</td> {# Format date #}
                                    <td>{{ appointment.start_hour|time:"H:i" }}</td> {# Format time #}
                                    <td>{{ appointment.end_hour|time:"H:i" }}</td> {# Format time #}
                                    <td class="text-center action-buttons">
                                        {# Button to Edit - links to an edit URL/view #}
                                        <a href="#" class="btn btn-sm btn-warning" title="Editar Cita">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        {# Button to Cancel - could trigger a modal confirmation #}
                                        <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#cancelModal{{ appointment.id }}" title="Cancelar Cita">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                        {# Add more actions if needed #}
                                    </td>
                                </tr>

                                {# --- Cancellation Confirmation Modal (Example) --- #}
                                <div class="modal fade" id="cancelModal{{ appointment.id }}" tabindex="-1" aria-labelledby="cancelModalLabel{{ appointment.id }}" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="cancelModalLabel{{ appointment.id }}">Confirmar Cancelación</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                ¿Está seguro de que desea cancelar la cita de <strong>{{ appointment.patient.first_name }} {{ appointment.patient.last_name }}</strong> para el servicio <strong>{{ appointment.service.name|default:'N/A' }}</strong> el día <strong>{{ appointment.date|date:"d/m/Y" }}</strong> a las <strong>{{ appointment.start_hour|time:"H:i" }}</strong>?
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                                                {# Form to submit the cancellation request #}
                                                <form action="#" method="post" style="display: inline;">
                                                    {% csrf_token %}
                                                    <button type="submit" class="btn btn-danger">Sí, Cancelar Cita</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {# --- End Modal --- #}

                                {% empty %}
                                <tr>
                                    <td colspan="6" class="text-center text-muted">No hay citas programadas.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div> {# End table-responsive #}

                    {# Optional: Add pagination controls here if needed #}

                </div> {# End card-body #}
            </div> {# End card #}
        </div> {# End container #}
    </main>

    {% include 'base/footer.html' %}
</div> {# End page-wrapper #}

{% bootstrap_javascript %} {# Include Bootstrap JS #}
{# Add links to custom JS files if needed #}
{# <script src="{% static 'js/admin_appointments.js' %}"></script> #}
</body>
</html>